<% layout('layout') -%>
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Client Dashboard</h3>
  <a class="btn btn-primary" href="/client/upload">New Check</a>
</div>

<table class="table table-hover">
  <thead>
    <tr>
      <th>Created</th>
      <th>Original File</th>
      <th>Output</th>
      <th>Total</th>
      <th>Clean</th>
      <th>Download</th>
    </tr>
  </thead>
  <tbody>
    <% files.forEach(f => { %>
    <tr>
      <td><%= new Date(f.created_at).toLocaleString() %></td>
      <td><%= f.original_filename %></td>
      <td><code><%= f.stored_filename %></code> (<%= f.output_format %>)</td>
      <td><%= f.record_count %></td>
      <td><%= f.unmatched_count %></td>
      <td>
        <a class="btn btn-sm btn-outline-success" href="<%= f.output_path%>">Download</a>
      </td>
    </tr>
    <% }) %>
  </tbody>
</table>

<!-- Pagination -->
<nav>
  <ul class="pagination">
    <% if (page > 1) { %>
      <li class="page-item">
        <a class="page-link" href="?page=<%= page - 1 %>">Previous</a>
      </li>
    <% } %>

    <% 
      let start = Math.max(1, page - 4);
      let end = Math.min(pages, page + 4);

      if (start > 1) { 
    %>
      <li class="page-item"><a class="page-link" href="?page=1">1</a></li>
      <% if (start > 2) { %><li class="page-item disabled"><span class="page-link">...</span></li><% } %>
    <% } %>

    <% for (let i = start; i <= end; i++) { %>
      <li class="page-item <%= i === page ? 'active' : '' %>">
        <a class="page-link" href="?page=<%= i %>"><%= i %></a>
      </li>
    <% } %>

    <% if (end < pages) { %>
      <% if (end < pages - 1) { %><li class="page-item disabled"><span class="page-link">...</span></li><% } %>
      <li class="page-item"><a class="page-link" href="?page=<%= pages %>"><%= pages %></a></li>
    <% } %>

    <% if (page < pages) { %>
      <li class="page-item">
        <a class="page-link" href="?page=<%= page + 1 %>">Next</a>
      </li>
    <% } %>
  </ul>
</nav>
 